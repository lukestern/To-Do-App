services:
- docker
script:
- docker build --target test --tag $DOCKER_USER/todo-app:test .
- docker run --env-file .env.test $DOCKER_USER/todo-app:test tests
- docker run -e TRELLO_BOARD_ID -e TRELLO_KEY -e TRELLO_TOKEN -e ID_ORGANIZATION $DOCKER_USER/todo-app:test
  tests_end_to_end
after_success:
- echo $DOCKER_PASSWD | docker login --username $DOCKER_USER --password-stdin
- docker pull $DOCKER_USER/todo-app:latest
- docker build --cache-from $DOCKER_USER/todo-app:latest --target production --tag $DOCKER_USER/todo-app:latest .
- docker tag $DOCKER_USER/todo-app:latest $DOCKER_USER/todo-app:$TRAVIS_COMMIT
- docker push $DOCKER_USER/todo-app:latest
- docker push $DOCKER_USER/todo-app:$TRAVIS_COMMIT
env:
  global:
  - DOCKER_USER: toastyluke
  - secure: fxSu16Yc/CQC460G8z0ooa6OD7Eg7v4s+AOLl7y1OsQaEzOYg0wdY3YsxCKx8pJKroZSwfbpeRGILV3sqqzp6n9L8cwd6XdhAGswe/eK7rBL/VnfytJ/LtzIJvFSMJgNHb4a6NxzM4mDjCV4KM9RI1iiE/spvt9zGhB7YPXB+p263hkOESfj9iqZf8BFAiT3AY95YtTWN2SzjpAFn8L2UuUZkHjtOA3gqiDnvCAonhuVnGasG1Ea/mVLoJT90onudZNZevl7rXgTXGgKQeYaHu/51y2q4xT6w+1B88Jbk5LmZp7hDrozSM7MVlP45zuW28WtHmZsWiJ/55UPmMDrXj55CGQYFfhTBK7xr7vtFERaFPA1sfuRZe4+P+JjlblzsQ/gEvD8L6ik3i3hM/SSkCxmmGAwdxcDGMhDeBfwtdmoM2mRgkr+cc5OJO4s/lKqxWkNpBjaKSqQZxavYHJS7Gp6NQL28JjgOS4sse7HrB5dxsUcfXpi1pdNuQy2Az99IPwIoHXTq7NwHdcWyP203ub/SRakcSrsDCq6Q//f33Tqr3Rg5qoeGXgFNdto1PQa0gNGpz8Kv3BTkW9XiPJ8JF7AYvwkymvrfeHZ05HOl7L2w4LxBIyAN/HtI5QAMqEwlgBKjWF2AkvNmbQlrW2VCrxdxxA2HqnIG3Dv10rrcUM=
  - secure: Xx/FqrC8awFRxxP1KdmQs+GiHOmWE4DFT2kLxF8Q69N48R+ischbc4dpOwMOOxWqCBcx8bzGGvTiQkE1gH8oFvN537qGRoksVzUUKx3urdXErPrAezFggNcbBszkf1iAEb6HoQ+/n1Q/mYsySMJwDLK4QpSIDMShswE1YORYp2+nrbFaek3q4DEMYtdhzqFa7cvWEnnUjdaZxe8OjFI1jdilCmvyfQlp0zl5kR6as77gOduuUek+c1AT/M3HQCN053MQZnfthffV33geH02yMoHGN/n4JsEDYSwONB9FM9WI1hLXzDVnMAPW2m/1LQWtVr+V8eWURdrUXoOkraXgHuSoX9YK6JVBwhX9tq8SwO+0nW3iKuZw4/5rVG33nOb9nCbo8OL/yj6LF8Y9Prvd/huyzEPKxUVMjy6VXQVc7j53a5MEVSqT56mt6EzG1xy+y0IvE0QbsDns8WkRdnNN/StIaexICuxXLYbK8Qmadn/0hM1yGMIHbmbvLIpw8DAm++fuOIotv76uHP3vEHKs4PvERsVK5nNhas0kTmJL+xNFy9aKgqvd4+htPAVxXMhlohOSqhp66M72CneraWAKs5rnlA3GwzpHpkktBFSNbgnybZ7QjQpNLtG89Ubx5RXKaNABRo7d/+9kvY10ZBltHWDUN4tKmSLknJTCKiLT0lk=
  - secure: IHD6Qj30A6eN/0cslyeMTK4iiJwZRiMBEbRqwyVfZdfhF4yIuwO6MQA1n6uCybstR+qRY1Wwmb7HCU2C7RnlVf1CU71FYOxDkWaymEeBWTK97W5xqZPb35i+fm/WKiQo4wyaRIFJZ8XYX5W9+jf3+n9qo6p6MU/SmT6GHgcb3rmfFjS7tiiy2vVZURoI4LT2+q3nfBRBrvdLrFNJf/DisIQuN1aYzM8xflB7EMCjuZS/4X8A/yktl1GNe2WqM3wT2XNuBFPVMDTyInYVYlSN3ZnX8sxzBSwPMQmz6iNk+6Fb3JJcZ7PIZPah3kC9yr5MS5zCjeK5ozyOX/pABlHEjnybw3733jN2OtdU1bRwQzyTHJGA4oz9MG0jbONl6vndQujP9NW+MFZNF/cyPN/dO3wTXylcCEwROkfffjZRSExo2S7mVL3oaczL4nOsdulZ4cgPDxC0w/PSprgkhYZaNRH3nJ12VTFFoc1TlVnkyo7OYFkb82StiD2yLmA9YProidnykeAEk68Pw78OfNU4mQF/9mFBuntWNikAhNwGdw/Rj+j3jywx+AP6Ik/NWLKU2oLWzRN9q5YxeL05myeECDdnp9QMSDrUsYte2ojojORbLJNzpHY2uDazObmj6i86XxVZ5fZrjbYWWRL8HsOslB7IJSApHGEHpsiTFgcpsUE=
  - secure: iU4T1WHEH3xZPuJWbPLEq/t/bfWoKhaujAQcTIkSEG63TJX5eTrLZZy8IEqwzPHasDUMZPjHrAHSJx6tiXRCwdITEzICBySDLNQfLGX7h2X5OSFj/r9R9zWkwbihsG9N9CZ8+jX2btiUH01l0sqM0SoKnlfLqBF6oeYsNinyHNgOmPDtZjdDflQK8Saoos0yE3uwExfGTVxjK36zox8qyK3I5hGGmLE91fQP/hKov88H80qrcdsjOi35nktN2G0CdXEdGmXGzkT+iJ9UFXjB0X85Q3lLrvF1Rli0toPpHnQXNDeRmW+EEE4tnjUL02qTQtV/lfVMqD4R26I58U4HGgv1WebKYyIwAwTJ6xqoR+qtw3KXYuevMqtH0SqihO6T1/J09paC5sAea+zxwRgFCt0/k8CkG3jNayeoGcj26+owMLibMefD1V12miENfxrCjqcWH5T8TiynkKaqRtjfZkwSuqFxteO16U/vAx/DZLJ/Q4kUk5X3b9T+ScxRDzEYL0VRfmgL836weBwR5GHY1fKv4wHTgFUAf9Wwm/Y8VUhKOGoyyYHwpJ+/kS6IKMJoeHm6CNeEvjUBaz+wZ8UrPPMJZ2MQE9rhyEOFwHIHPyVbMpkpxNUHn2mhNuS7S7txCAVl/IWKEE8KFx8W/vfW1WcbkCfeFS8m2/FN0zPiy2M=
  - secure: kxTqr+zEG/JE3gg0QqEoB8BMTzqJyvXjQjgWUz8bxJ0X9KGeIMleJh5fD6/AYSnhtWZ+nak0dwY3SUI1peVKRg7hBIyLsCBOWMr9fBk3zH5A9IaeT6I8JbQ2hZFfQNtNIG8C4zHMPIdr3TgoIktQNvMDF16hsGC9FFVuddbesff8obzm3E8kc9B5FZAJ6x7CCg4c/kYhKAyoULeJvVxKZVR2AjapOzUUvsOQiltrBDrjytjZEenM3ke7YcvvhFRgaBtxiJEbeCgSZIgmOg5rc6qSAYXACVCYnhxsduTXq7F9Ll9PLigy5KvDEcBjcvHm4BBnYZaoPLL6Dn8EugAh0vcLHeHjW0i8k0C34meGepe2eRb8CJu7sgLNQawJ/MIqwSyARJT1XjzM5Me73b16rjS1p6FfVHTk3GwbOOFspP8/kw4+0DMKpsQu7BOnNjaFv2Qyyak2LGj6OE0k35Yxwg1qV9ioWjbuLeX1gtrjDxcG3X2UW8bhzWEkS3YyqM63mnp2EHQ7UTFgLdVX4kHzUjpuhVCq7N8dGRfntWV8tEvMEDoFSoiROaIAltfIz4otOw2/+f6n7sCQD+jknM2Ak6l6LZFRubHjyoeHJHa7Nf5uy12jF0DAuoJCYEIq8b5UHLTJv6y0xv5WzkDELozaEveJOI9jRwoBAdAbASOO7eo=
notifications:
  slack:
    secure: aK5ycpRhw4sf4a6M/graRjgAXK5UkasRjErYiyPGP405OjhFoGsrpU5Xi689l6TPMs0pq9R0U20f67jn0JrR2z9dXx+JSjZKFWiZGlhmwPsMJ32kNDr7Lr3GozFlbDrzAtQd3yorVenvUPiZqBASY5TbMXPHDI/vRgUwFAa37nT/j/mFvuk9cr2QX8NUXt4cUxqfGLkJJiniw0IkwKyV4P8ub+uahIpUjW+GmQhogO0Pplv4/L9y7rz7x7u+RoCPRX11t/YPgDd3RA16dO23w0hUa3EZ4HjGzTe44NxlatQQ6MHrFUQh4/t74rl+grbPD/5ZacTT6+A/AITIPh96IujgpKNuWmwNCgNMKDyHWJEwkfbWI3UO40JFUnYLvlX0j8lfMwqqB2q/+SlwINbVJK+HQbNlAm5guVsyrKcl7fEvg6w51WQYZ1ishB/1oMUkC0FEW5raHS7m+JnaRAQ2FMsUeygsUA434KUjGU8FF+FoaGYXhogCRY8gOh/aJaUwOh59x89Y4ZPYSLt6UYCGgGE6ESDyqmLqGmecsRzvhijSVBl8BQbrpbXuWl3IB3YBZKx2PiANTu0edNBt2TZ5bW2SBQr7jvbfqX+1riSX/OMgWGG0T2yK8Lpf4ytQz4HLalLUh96K/5yR11WZL49k7JVfFd8XnX0oB5okQF4Kmmw=
    on_success: change
    on_failure: always
